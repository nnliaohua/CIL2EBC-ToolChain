<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-CN" xml:lang="zh-CN" xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>EBC Local Language Standard(Draft)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<body style="line-height:1.5em;background:#fffff0">
<style>
h1{font-size:1.8em;line-height:1.3em;text-align:center;}
hr{width:60%;height:3px;color:#ff0000}
li{margin-top:0.8em;margin-bottom:0.8em;}
.cds{color:#108010;background-color:#fae0f0;font-weight:bold;}
</style>
<h1>EBC Local Language Standard(Draft)<br />EBC方言标准(草案)</h1>
<hr />
Because UEFI standard have no clear definitions of calligraph of EBC, this appoint a local language standard, for project purpose.<br />
<ul>
<li>Letter case sensitive appointment: most assembly language appoint: assembly instruction is not case sensitive, but UEFI say he is C-like, and C language is case sensitive. so extra appointment give here: all assembly instructions/register names must upper case, lower case will be compile error. that is: <span class="cds">&nbsp;MOV R1, R7&nbsp;</span> is correct, but <span class="cds">&nbsp;mov r1, r7&nbsp;</span> will be compile error.</li>
<li>Appointment of label's case sensitive: ECMA-335 standard define: labels only differ on upper/lower case are compile warning, for simplify project codes, rise this level to compile error. all labels that only differ on upper/lower case are compile error. for example, if both <span class="cds">_main()</span> and <span class="cds">_MAIN()</span> happened on a file, will be defined as compile error.</li>
<li>There are three Hex Number formats defined on UEFI standard: <span class="cds">&nbsp;0xFA8012B07E&nbsp;</span>, <span class="cds">&nbsp;0xFA 8012 B07E&nbsp;</span>, <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span>. here appiont that <span class="cds">&nbsp;0xFA 8012 B07E&nbsp;</span> format is not allowed(can not use space as separator), only allowed two formats of <span class="cds">&nbsp;0xFA8012B07E&nbsp;</span> and <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span>(use underline as separator is allowed), and, while CIL2EBC generate .EBCasm source file, it always automatically add underline as separator per 4 four digits(that is , The CIL source file is <span class="cds">&nbsp;0xFA8012B07E&nbsp;</span>, the generated .EBCasm source file will be automatically changed as <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span>).</li>
<li>The CIL .asm source file generated by VS2013, the Hex Number always lower case, CIL2EBC change all of it to upper case, and if you handwrite .EBCasm source file, lower case will be defined as compile error. That is, <span class="cds">&nbsp;0xfa_8012_b07e&nbsp;</span> is compile error, <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span> is correct. This is a very simple compile, more restrictions on calligraph, more easy to produce this compile.</li>
<li>There are three Dec Number formats defined on UEFI standard: <span class="cds">&nbsp;14283396589&nbsp;</span>, <span class="cds">&nbsp;142 8339 6589&nbsp;</span>, <span class="cds">&nbsp;142_8339_6589&nbsp;</span>. here appiont that <span class="cds">&nbsp;142 8339 6589&nbsp;</span> format is not allowed(can not use space as separator), only allowed two formats of <span class="cds">&nbsp;14283396589&nbsp;</span>, <span class="cds">&nbsp;142_8339_6589&nbsp;</span>(use underline as separator is allowed), and, while CIL2EBC generate .EBCasm source file, it always automatically add underline as separator per 4 four digits(that is , The CIL source file is <span class="cds">&nbsp;14283396589&nbsp;</span>, the generated .EBCasm source file will be automatically changed as <span class="cds">&nbsp;142_8339_6589&nbsp;</span>).</li>
<li>ECMA-335 standard defined <span class="cds">&nbsp;.data&nbsp;</span> directive, but it is changed as <span class="cds">&nbsp;.rdata&nbsp;</span> directive on VS2013. Its is decided that do not support <span class="cds">&nbsp;.data&nbsp;</span> directive, only support <span class="cds">&nbsp;.rdata&nbsp;</span> directive, and translate it as <span class="cds">&nbsp;.VarBss&nbsp;</span> segment defined on UEFI standard.</li>
<li>ECMA-335 standard have no describe on <span class="cds">&nbsp;.import&nbsp;</span>, <span class="cds">&nbsp;.export&nbsp;</span> keyword, it only occur on [Annex C] curiously(I don't understand, it is not mentioned by official contents), and UEFI standard have no any <span class="cds">&nbsp;.import&nbsp;</span>, <span class="cds">&nbsp;.export&nbsp;</span> keyword. It is decided that all functions that need to <span class="cds">&nbsp;thunk&nbsp;</span> must use <span class="cds">&nbsp;.export&nbsp;</span> directive to declare, all functions that have no <span class="cds">&nbsp;.export&nbsp;</span> directive will have not <span class="cds">&nbsp;thunk&nbsp;</span>; All functions that need to <span class="cds">&nbsp;CALLEX&nbsp;</span> must use <span class="cds">&nbsp;.import&nbsp;</span> directive to declare, all functions that have no <span class="cds">&nbsp;.import&nbsp;</span> directive will be <span class="cds">&nbsp;CALL&nbsp;</span> directly. Because CIL .asm source file generated by VS2013  is completely have no such two keywords, so you must add this two keywords to the CIL .asm source file manually, then CIL2EBC can generate correct EBC assembly instructions for you.</li>
<li>That is all for now, other local language standard will be add in on the progress of work.</li>
</ul>
<hr />
由于 UEFI标准并没有对 EBC文法给出具体明确的定义, 这里制定一个方言标准, 以便于利用.<br />
<ul>
<li>汇编指令的大小写规定: 大多数汇编语言规定, 汇编指令是不区分大小写的, 但是 UEFI标准却说是 C-like, 而C语言是区分大小写的. 所以这里额外规定: 所有汇编指令/寄存器名都必须大写, 小写被认为是编译错误. 即: <span class="cds">&nbsp;MOV R1, R7&nbsp;</span> 是正确的, 而 <span class="cds">&nbsp;mov r1, r7&nbsp;</span> 则被认为是编译错误.</li>
<li>标识符大小写规定: ECMA-335标准把字母相同、大小写不同的 CIL 标识符定义为编译警告, 这里为了简化设计, 把它严格化, 凡是字母相同、大小写不同的标识符, 全部定义为编译错误. 比如 <span class="cds">_main()</span> 和 <span class="cds">_MAIN()</span> 如果同时出现, 就被定义为编译错误.</li>
<li>UEFI标准对于 Hex Number 定义有3种格式: <span class="cds">&nbsp;0xFA8012B07E&nbsp;</span>, <span class="cds">&nbsp;0xFA 8012 B07E&nbsp;</span>, <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span>. 这里规定不允许使用 <span class="cds">&nbsp;0xFA 8012 B07E&nbsp;</span>格式(使用空格作为分隔符), 只允许使用<span class="cds">&nbsp;0xFA8012B07E&nbsp;</span>, <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span>两种格式(允许使用下划线作为分隔符). 并且 CIL2EBC 生成 .EBCasm 文件的时候, 总是自动地每隔4位加入一个下划线作为分隔符(即: CIL 源文件为 <span class="cds">&nbsp;0xFA8012B07E&nbsp;</span>, 所生成的 .EBCasm文件会被自动改成 <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span>).</li>
<li>VS2013 所生成的 CIL .asm 源文件, Hex Number 全部小写, CIL2EBC 把它们全部改成大写, 并且如果你手写 .EBCasm 文件, 小写会被定义为编译错误. 即: <span class="cds">&nbsp;0xfa_8012_b07e&nbsp;</span>是编译错误, <span class="cds">&nbsp;0xFA_8012_B07E&nbsp;</span>才是对的. 这是一个非常简单的编译器, 文法定义得越严格, 编译器的制作越方便.</li>
<li>UEFI标准对于 Dec Number 定义有3种格式: <span class="cds">&nbsp;14283396589&nbsp;</span>, <span class="cds">&nbsp;142 8339 6589&nbsp;</span>, <span class="cds">&nbsp;142_8339_6589&nbsp;</span>. 这里规定不允许使用 <span class="cds">&nbsp;142 8339 6589&nbsp;</span>格式(使用空格作为分隔符), 只允许使用<span class="cds">&nbsp;14283396589&nbsp;</span>, <span class="cds">&nbsp;142_8339_6589&nbsp;</span>两种格式(允许使用下划线作为分隔符). 并且 CIL2EBC 生成 .EBCasm 文件的时候, 总是自动每隔4位加入一个下划线作为分隔符(即: CIL 源文件为 <span class="cds">&nbsp;14283396589&nbsp;</span>, 所生成的 .EBCasm文件会被自动改成 <span class="cds">&nbsp;142_8339_6589&nbsp;</span>).</li>
<li>ECMA-335里面的标准 CIL, 定义有 <span class="cds">&nbsp;.data&nbsp;</span> 伪指令, 但是这在 VS2013 里面变成了 <span class="cds">&nbsp;.rdata&nbsp;</span> 伪指令. 这里决定不支持<span class="cds">&nbsp;.data&nbsp;</span> 伪指令, 仅支持 <span class="cds">&nbsp;.rdata&nbsp;</span> 伪指令, 并且把它翻译为 UEFI标准里面的 <span class="cds">&nbsp;.VarBss&nbsp;</span> 数据段.</li>
<li>ECMA-335标准里面并没有描述 <span class="cds">&nbsp;.import&nbsp;</span>, <span class="cds">&nbsp;.export&nbsp;</span>关键字, 仅仅只在〖附录C〗里面莫明其妙地出现有这样两个关键字(不知道是什么意思, 正文里面根本没提); UEFI标准里面则完全没有 <span class="cds">&nbsp;.import&nbsp;</span>, <span class="cds">&nbsp;.export&nbsp;</span>关键字. 这里决定: 凡是需要做 <span class="cds">&nbsp;thunk&nbsp;</span> 的函数全部都必须使用 <span class="cds">&nbsp;.export&nbsp;</span> 伪指令进行定义, 凡是没有经过 <span class="cds">&nbsp;.export&nbsp;</span> 伪指令定义的函数全部都不给它做 <span class="cds">&nbsp;thunk&nbsp;</span>; 凡是需要 <span class="cds">&nbsp;CALLEX&nbsp;</span> 的函数全部都必须使用 <span class="cds">&nbsp;.import&nbsp;</span> 伪指令进行定义, 凡是没有使用 <span class="cds">&nbsp;.import&nbsp;</span> 伪指令定义过的函数全部都直接 <span class="cds">&nbsp;CALL&nbsp;</span>. 因为 VS2013 所生成的 CIL .asm 里面是完全没有这两个关键字的, 所以, 你必须得在 VS2013 所生成的 CIL .asm 里面手工加入这两个关键字, CIL2EBC 才能够为你生成正确的 EBC汇编指令.</li>
<li>暂时就这些, 其它的方言标准会随着工作进展陆续加入.</li>
</ul>
</body>
</html>
